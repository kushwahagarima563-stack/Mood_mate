"use strict";(()=>{var e={};e.id=4486,e.ids=[4486],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},50541:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>N,requestAsyncStorage:()=>S,routeModule:()=>O,serverHooks:()=>R,staticGenerationAsyncStorage:()=>q});var o={};r.r(o),r.d(o,{POST:()=>C,runtime:()=>E});var n=r(49303),s=r(88716),a=r(60670),i=r(87070),l=r(71615),u=r(83543);function c(){return"undefined"!=typeof window&&void 0!==window.document}let d={path:"/",sameSite:"lax",httpOnly:!1,maxAge:3456e4},p=/^(.*)[.](0|[1-9][0-9]*)$/;function f(e,t){if(e===t)return!0;let r=e.match(p);return!!r&&r[1]===t}function m(e,t,r){let o=r??3180,n=encodeURIComponent(t);if(n.length<=o)return[{name:e,value:t}];let s=[];for(;n.length>0;){let e=n.slice(0,o),t=e.lastIndexOf("%");t>o-3&&(e=e.slice(0,t));let r="";for(;e.length>0;)try{r=decodeURIComponent(e);break}catch(t){if(t instanceof URIError&&"%"===e.at(-3)&&e.length>3)e=e.slice(0,e.length-3);else throw t}s.push(r),n=n.slice(e.length)}return s.map((t,r)=>({name:`${e}.${r}`,value:t}))}async function h(e,t){let r=await t(e);if(r)return r;let o=[];for(let r=0;;r++){let n=`${e}.${r}`,s=await t(n);if(!s)break;o.push(s)}return o.length>0?o.join(""):null}let g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),y=" 	\n\r=".split(""),w=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<y.length;t+=1)e[y[t].charCodeAt(0)]=-2;for(let t=0;t<g.length;t+=1)e[g[t].charCodeAt(0)]=t;return e})();function b(e){let t=[],r=0,o=0;if(function(e,t){for(let r=0;r<e.length;r+=1){let o=e.charCodeAt(r);if(o>55295&&o<=56319){let t=(o-55296)*1024&65535;o=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127){t(e);return}if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(o,t)}}(e,e=>{for(r=r<<8|e,o+=8;o>=6;){let e=r>>o-6&63;t.push(g[e]),o-=6}}),o>0)for(r<<=6-o,o=6;o>=6;){let e=r>>o-6&63;t.push(g[e]),o-=6}return t.join("")}function k(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},o={utf8seq:0,codepoint:0},n=0,s=0;for(let t=0;t<e.length;t+=1){let a=w[e.charCodeAt(t)];if(a>-1)for(n=n<<6|a,s+=6;s>=8;)(function(e,t,r){if(0===t.utf8seq){if(e<=127){r(e);return}for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}})(n>>s-8&255,o,r),s-=8;else if(-2===a)continue;else throw Error(`Invalid Base64-URL character "${e.at(t)}" at position ${t}`)}return t.join("")}let A="base64-";async function v({getAll:e,setAll:t,setItems:r,removedItems:o},n){let s=n.cookieEncoding,a=n.cookieOptions??null,i=await e([...r?Object.keys(r):[],...o?Object.keys(o):[]]),l=i?.map(({name:e})=>e)||[],u=Object.keys(o).flatMap(e=>l.filter(t=>f(t,e))),c=Object.keys(r).flatMap(e=>{let t=new Set(l.filter(t=>f(t,e))),o=r[e];"base64url"===s&&(o=A+b(o));let n=m(e,o);return n.forEach(e=>{t.delete(e.name)}),u.push(...t),n}),p={...d,...a,maxAge:0},h={...d,...a,maxAge:d.maxAge};delete p.name,delete h.name,await t([...u.map(e=>({name:e,value:"",options:p})),...c.map(({name:e,value:t})=>({name:e,value:t,options:h}))])}var x=r(94738);let E="nodejs";function I(e,t){let r={happy:["You're radiating joy today!","You look cheerful and bright!","Your smile is contagious!"],sad:["You seem a bit down today. Take care of yourself.","Looks like you're feeling melancholic.","Remember, it's okay to have tough days."],angry:["You seem a bit tense. Take a deep breath!","Looks like something's bothering you.","Try to find some calm in your day."],surprised:["You look surprised! Something exciting happen?","Your expression shows amazement!","You seem caught off guard!"],neutral:["You're looking calm and composed.","A peaceful, neutral expression today.","You seem relaxed and centered."],fearful:["You seem a bit anxious. Everything okay?","Your expression shows some worry.","Take a moment to relax and breathe."]},o=r[e]||r.neutral;return o[Math.floor(Math.random()*o.length)]}async function j(e){let t=process.env.AZURE_FACE_ENDPOINT,r=process.env.AZURE_FACE_API_KEY;if(!t||!r)throw Error("Azure Face API credentials not configured");let o=await fetch(`${t}/face/v1.0/detect?returnFaceAttributes=emotion`,{method:"POST",headers:{"Content-Type":"application/json","Ocp-Apim-Subscription-Key":r},body:JSON.stringify({url:e})});if(!o.ok){let e=await o.text().catch(()=>"");throw Error(`Azure Face API request failed: ${o.status} ${e}`)}let n=await o.json();if(!Array.isArray(n)||0===n.length)throw Error("No face detected in image");let s=n[0]?.faceAttributes?.emotion;if(!s)throw Error("Missing emotion attributes in Azure response");let a="neutral",i=-1;for(let[e,t]of Object.entries(s)){let r="number"==typeof t?t:Number(t);r>i&&(i=r,a=e)}return{emotion:a,emotion_scores:s,summary:I(a,s)}}async function C(e){try{let t;let r=(0,l.cookies)(),o=function(e,t,r){if(!e||!t)throw Error(`Your project's URL and Key are required to create a Supabase client!

Check your Supabase project's API settings to find these values

https://supabase.com/dashboard/project/_/settings/api`);let{storage:o,getAll:n,setAll:s,setItems:a,removedItems:i}=function(e,t){let r,o;let n=e.cookies??null,s=e.cookieEncoding,a={},i={};if(n){if("get"in n){let e=async e=>{let t=e.flatMap(e=>[e,...Array.from({length:5}).map((t,r)=>`${e}.${r}`)]),r=[];for(let e=0;e<t.length;e+=1){let o=await n.get(t[e]);(o||"string"==typeof o)&&r.push({name:t[e],value:o})}return r};if(r=async t=>await e(t),"set"in n&&"remove"in n)o=async e=>{for(let t=0;t<e.length;t+=1){let{name:r,value:o,options:s}=e[t];o?await n.set(r,o,s):await n.remove(r,s)}};else if(t)o=async()=>{console.warn("@supabase/ssr: createServerClient was configured without set and remove cookie methods, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness. Consider switching to the getAll and setAll cookie methods instead of get, set and remove which are deprecated and can be difficult to use correctly.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring a getAll and setAll cookie method (deprecated: alternatively both get, set and remove can be used)")}else if("getAll"in n){if(r=async()=>await n.getAll(),"setAll"in n)o=n.setAll;else if(t)o=async()=>{console.warn("@supabase/ssr: createServerClient was configured without the setAll cookie method, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring both getAll and setAll cookie methods (deprecated: alternatively both get, set and remove can be used)")}else throw Error(`@supabase/ssr: ${t?"createServerClient":"createBrowserClient"} requires configuring getAll and setAll cookie methods (deprecated: alternatively use get, set and remove).${c()?" As this is called in a browser runtime, consider removing the cookies option object to use the document.cookie API automatically.":""}`)}else if(!t&&c()){let e=()=>{let e=(0,u.Qc)(document.cookie);return Object.keys(e).map(t=>({name:t,value:e[t]??""}))};r=()=>e(),o=e=>{e.forEach(({name:e,value:t,options:r})=>{document.cookie=(0,u.qC)(e,t,r)})}}else if(t)throw Error("@supabase/ssr: createServerClient must be initialized with cookie options that specify getAll and setAll functions (deprecated, not recommended: alternatively use get, set and remove)");else r=()=>[],o=()=>{throw Error("@supabase/ssr: createBrowserClient in non-browser runtimes (including Next.js pre-rendering mode) was not initialized cookie options that specify getAll and setAll functions (deprecated: alternatively use get, set and remove), but they were needed")};return t?{getAll:r,setAll:o,setItems:a,removedItems:i,storage:{isServer:!0,getItem:async e=>{if("string"==typeof a[e])return a[e];if(i[e])return null;let t=await r([e]),o=await h(e,async e=>{let r=t?.find(({name:t})=>t===e)||null;return r?r.value:null});if(!o)return null;let n=o;return"string"==typeof o&&o.startsWith(A)&&(n=k(o.substring(A.length))),n},setItem:async(t,n)=>{t.endsWith("-code-verifier")&&await v({getAll:r,setAll:o,setItems:{[t]:n},removedItems:{}},{cookieOptions:e?.cookieOptions??null,cookieEncoding:s}),a[t]=n,delete i[t]},removeItem:async e=>{delete a[e],i[e]=!0}}}:{getAll:r,setAll:o,setItems:a,removedItems:i,storage:{isServer:!1,getItem:async e=>{let t=await r([e]),o=await h(e,async e=>{let r=t?.find(({name:t})=>t===e)||null;return r?r.value:null});if(!o)return null;let n=o;return o.startsWith(A)&&(n=k(o.substring(A.length))),n},setItem:async(t,n)=>{let a=await r([t]),i=new Set((a?.map(({name:e})=>e)||[]).filter(e=>f(e,t))),l=n;"base64url"===s&&(l=A+b(n));let u=m(t,l);u.forEach(({name:e})=>{i.delete(e)});let c={...d,...e?.cookieOptions,maxAge:0},p={...d,...e?.cookieOptions,maxAge:d.maxAge};delete c.name,delete p.name;let h=[...[...i].map(e=>({name:e,value:"",options:c})),...u.map(({name:e,value:t})=>({name:e,value:t,options:p}))];h.length>0&&await o(h)},removeItem:async t=>{let n=await r([t]),s=(n?.map(({name:e})=>e)||[]).filter(e=>f(e,t)),a={...d,...e?.cookieOptions,maxAge:0};delete a.name,s.length>0&&await o(s.map(e=>({name:e,value:"",options:a})))}}}}({...r,cookieEncoding:r?.cookieEncoding??"base64url"},!0),l=(0,x.eI)(e,t,{...r,global:{...r?.global,headers:{...r?.global?.headers,"X-Client-Info":"supabase-ssr/0.7.0 createServerClient"}},auth:{...r?.cookieOptions?.name?{storageKey:r.cookieOptions.name}:null,...r?.auth,flowType:"pkce",autoRefreshToken:!1,detectSessionInUrl:!1,persistSession:!0,storage:o}});return l.auth.onAuthStateChange(async e=>{(Object.keys(a).length>0||Object.keys(i).length>0)&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e||"USER_UPDATED"===e||"PASSWORD_RECOVERY"===e||"SIGNED_OUT"===e||"MFA_CHALLENGE_VERIFIED"===e)&&await v({getAll:n,setAll:s,setItems:a,removedItems:i},{cookieOptions:r?.cookieOptions??null,cookieEncoding:r?.cookieEncoding??"base64url"})}),l}("https://uhmjdujijoywhyrugplb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVobWpkdWppam95d2h5cnVncGxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDI3OTQsImV4cCI6MjA3NDk3ODc5NH0.i4_xrI-ZdDaSEgoXgsIrJRl1tPjP7Z-x2byn1KlXKwA",{cookies:{get:e=>r.get(e)?.value,set(e,t,o){try{r.set({name:e,value:t,...o})}catch{}},remove(e,t){try{r.set({name:e,value:"",...t,maxAge:0})}catch{}}}}),{data:{user:n},error:s}=await o.auth.getUser();if(s||!n)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a=(await e.formData()).get("file");if(!a)return i.NextResponse.json({error:"No file provided"},{status:400});let p=a.name.split(".").pop()||"jpg",g=`${n.id}/${Date.now()}.${p}`,{error:y}=await o.storage.from("selfies").upload(g,a,{contentType:a.type,upsert:!1});if(y)return console.error("Upload error:",y),i.NextResponse.json({error:"Failed to upload image"},{status:500});let{data:w}=o.storage.from("selfies").getPublicUrl(g),E=w.publicUrl;process.env.AZURE_FACE_API_KEY&&process.env.AZURE_FACE_ENDPOINT?t=await j(E):(console.warn("Using mock emotion analysis. Configure Azure env vars for production."),t=function(e){let t=["happy","sad","angry","surprised","neutral","fearful"],r=t[Math.floor(Math.random()*t.length)],o={};for(let e of t)o[e]=e===r?.85:.15*Math.random();if(e){let r=e.length%t.length,n=t[r];for(let e of t)o[e]=e===n?.9:.1*Math.random();return{emotion:n,emotion_scores:o,summary:I(n,o)}}return{emotion:r,emotion_scores:o,summary:I(r,o)}}(a.name));let{data:C,error:O}=await o.from("selfie_logs").insert({user_id:n.id,image_url:E,emotion:t.emotion,emotion_scores:t.emotion_scores,summary:t.summary}).select().single();if(O)return console.error("Database error:",O),i.NextResponse.json({error:"Failed to save selfie log"},{status:500});return i.NextResponse.json({success:!0,data:C})}catch(e){return console.error("Error processing selfie:",e),i.NextResponse.json({error:"Failed to process selfie"},{status:500})}}let O=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/selfie/analyze/route",pathname:"/api/selfie/analyze",filename:"route",bundlePath:"app/api/selfie/analyze/route"},resolvedPagePath:"C:\\Users\\Garima\\Desktop\\Mood_mate\\app\\api\\selfie\\analyze\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:S,staticGenerationAsyncStorage:q,serverHooks:R}=O,_="/api/selfie/analyze/route";function N(){return(0,a.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:q})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,4738,2855],()=>r(50541));module.exports=o})();