"use strict";(()=>{var e={};e.id=5162,e.ids=[5162],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},23481:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>l,POST:()=>p});var i=r(49303),o=r(88716),a=r(60670),n=r(62632),u=r(87070);async function p(e){try{let t=await e.json(),r=t?.user_id,s=t?.image_url,i=t?.emotion,o=t?.storage_path??null;if(!r||!s||!i)return u.NextResponse.json({success:!1,error:"Missing required fields: user_id, image_url, emotion"},{status:400});let{error:a}=await n.p.from("selfies").insert({id:crypto.randomUUID(),user_id:r,image_url:s,emotion:i,date:new Date().toISOString(),storage_bucket:"selfies",storage_path:o});if(a)return u.NextResponse.json({success:!1,error:a.message},{status:500});return u.NextResponse.json({success:!0,selfie:{user_id:r,image_url:s,emotion:i,date:new Date().toISOString()}})}catch(e){return u.NextResponse.json({success:!1,error:e?.message||"Unexpected error"},{status:500})}}async function l(e){let{searchParams:t}=new URL(e.url),r=t.get("emotion"),s=t.get("user_id")||void 0,i=n.p.from("selfies").select("*").order("date",{ascending:!1});r&&(i=i.eq("emotion",r)),s&&(i=i.eq("user_id",s));let{data:o,error:a}=await i;return a?u.NextResponse.json({success:!1,error:a.message},{status:500}):u.NextResponse.json({success:!0,selfies:o||[]})}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/selfie/route",pathname:"/api/selfie",filename:"route",bundlePath:"app/api/selfie/route"},resolvedPagePath:"C:\\Users\\Garima\\Desktop\\Mood_mate\\app\\api\\selfie\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f}=c,g="/api/selfie/route";function x(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},62632:(e,t,r)=>{r.d(t,{h:()=>u,p:()=>a});var s=r(94738);let i="https://uhmjdujijoywhyrugplb.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!i)throw Error("Missing NEXT_PUBLIC_SUPABASE_URL. Set it in your environment.");if(!o)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY. Set it in your environment.");let a=(0,s.eI)(i,o),n=e=>new Promise(t=>setTimeout(t,e));async function u(e,t={public:!0}){let r;for(let t=1;t<=3;t++){let{data:s,error:i}=await a.storage.getBucket(e);if(s&&!i)return s;if(i){if(r=i,404===i.status||/not.*found/i.test(i.message||""))break;await n(250*t);continue}break}for(let s=1;s<=3;s++){let{data:i,error:o}=await a.storage.createBucket(e,{public:t.public??!0,fileSizeLimit:t.fileSizeLimit,allowedMimeTypes:t.allowedMimeTypes});if(i&&!o)return i;if(o&&(/already exists/i.test(o.message||"")||409===o.status)){let{data:t}=await a.storage.getBucket(e);if(t)return t}r=o,await n(300*s)}throw Error(`Failed to ensure bucket "${e}": ${r?.message||"Unknown error"}`)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,4738],()=>r(23481));module.exports=s})();