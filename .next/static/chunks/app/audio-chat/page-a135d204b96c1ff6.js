(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{6489:function(e,t,r){Promise.resolve().then(r.bind(r,8930))},8930:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var s=r(7437),a=r(7268);function n(){return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-8",children:"Audio Chat"}),(0,s.jsx)(a.Z,{})]})}},7268:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var s=r(7437),a=r(2265),n=r(9322),l=r(8662),i=r(1094),o=r(1817),c=r(2934);function d(){let[e,t]=(0,a.useState)(!1),[r,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(null),[p,g]=(0,a.useState)(0),[f,b]=(0,a.useState)(!0),[y,w]=(0,a.useState)(""),v=(0,a.useRef)(null),j=(0,a.useRef)([]);async function N(){try{h(null);let e=await navigator.mediaDevices.getUserMedia({audio:!0});j.current=[];let r=new MediaRecorder(e,{mimeType:"audio/webm"});v.current=r,r.ondataavailable=e=>{e.data&&e.data.size>0&&j.current.push(e.data)},r.onstop=()=>{e.getTracks().forEach(e=>e.stop())},r.start(),t(!0)}catch(e){h((null==e?void 0:e.message)||"Microphone permission denied or unsupported browser.")}}async function k(){let e=v.current;if(!e){h("Recorder not initialized.");return}return d(!0),new Promise(r=>{e.onstop=async()=>{try{let e=new Blob(j.current,{type:"audio/webm"});if(e.size<2e3){h("Recording too short. Please record for at least 1 second."),d(!1),r();return}console.log("Session ID:",y),console.log("Blob size:",e.size);let t=new FormData;t.append("file",e,"speech.webm"),t.append("sessionId",y),console.log("Uploading to /api/audio/upload...");let s=await fetch("/api/audio/upload",{method:"POST",body:t});if(!s.ok){let e=await s.text();throw console.error("Upload failed:",e),Error(e||"Upload failed: ".concat(s.status))}let a=await s.json();console.log("Upload response:",a);let n={sessionId:y,pathOrUrl:a.storagePath||a.signedUrl};console.log("Calling /api/voice with payload:",n);let l=await fetch("/api/voice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok){let e=await l.text();throw console.error("Voice pipeline failed:",e),Error(e||"Voice pipeline failed: ".concat(l.status))}let i=await l.json();console.log("Voice response:",i),(null==i?void 0:i.ttsAudioUrl)&&new Audio(i.ttsAudioUrl).play().catch(e=>{console.error("Audio playback failed:",e)}),m(i),h(null)}catch(e){console.error("Error in stopRecordingAndUpload:",e),h((null==e?void 0:e.message)||"Failed to analyze audio. Please try again.")}finally{d(!1),r()}},v.current.stop(),t(!1)})}return((0,a.useEffect)(()=>{b(!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&"undefined"!=typeof MediaRecorder),y||w("session_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15)))},[]),(0,a.useEffect)(()=>{let t;return e?t=setInterval(()=>g(e=>e+1),1e3):(clearInterval(t),g(0)),()=>clearInterval(t)},[e]),f)?(0,s.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[!e&&!r&&!u&&(0,s.jsxs)("button",{onClick:N,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Start recording",children:[(0,s.jsx)(l.Z,{className:"w-5 h-5"}),"Start Recording"]}),e&&(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-800",children:"".concat(Math.floor(p/60).toString().padStart(2,"0"),":").concat((p%60).toString().padStart(2,"0"))})]}),(0,s.jsxs)("button",{onClick:k,className:"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors","aria-label":"Stop recording",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5"}),"Stop & Analyze"]})]}),r&&(0,s.jsxs)("div",{className:"flex items-center gap-3 text-blue-600",children:[(0,s.jsx)(o.Z,{className:"w-6 h-6 animate-spin"}),(0,s.jsx)("span",{className:"font-medium",children:"Processing audio..."})]}),u&&(0,s.jsx)("button",{onClick:function(){m(null),h(null),t(!1),d(!1),g(0),j.current=[],v.current=null},className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:"Record Again"})]})}),x&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[(0,s.jsx)(n.Z,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-red-700 font-medium",children:"Error"}),(0,s.jsx)("p",{className:"text-red-600 text-sm",children:x})]})]}),u&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-600 mb-4",children:[(0,s.jsx)(c.Z,{className:"w-6 h-6"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Analysis Complete"})]}),u.transcript&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Transcript"}),(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,s.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:u.transcript})})]}),u.emotions&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Emotional Analysis"}),(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,s.jsx)("pre",{className:"text-sm text-gray-700 overflow-x-auto",children:JSON.stringify(u.emotions,null,2)})})]}),u.assistantText&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"AI Response"}),(0,s.jsx)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,s.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:u.assistantText})})]}),u.ttsAudioUrl&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:"AI Audio"}),(0,s.jsx)("audio",{src:u.ttsAudioUrl,controls:!0,preload:"none",className:"w-full"})]})]})]}):(0,s.jsx)("div",{className:"max-w-3xl mx-auto p-6",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsx)(n.Z,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-red-700",children:"Your browser doesn't support audio recording."}),(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Please use a modern browser like Chrome, Firefox, or Edge."})]})})})}},9205:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var s=r(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),l=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:d="",children:u,iconNode:m,...x}=e;return(0,s.createElement)("svg",{ref:t,...c,width:a,height:a,stroke:r,strokeWidth:l?24*Number(n)/Number(a):n,className:i("lucide",d),...!u&&!o(x)&&{"aria-hidden":"true"},...x},[...m.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,s.forwardRef)((r,n)=>{let{className:o,...c}=r;return(0,s.createElement)(d,{ref:n,iconNode:t,className:i("lucide-".concat(a(l(e))),"lucide-".concat(e),o),...c})});return r.displayName=l(e),r}},9322:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2934:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},1817:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8662:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]])},1094:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(9205).Z)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]])}},function(e){e.O(0,[971,117,744],function(){return e(e.s=6489)}),_N_E=e.O()}]);